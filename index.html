<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø Scotland Guide</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}
body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: #1a2b3d;
color: #fff;
height: 100vh;
overflow: hidden;
touch-action: manipulation;
}
header {
background: #0f1a25;
padding: 15px 20px;
box-shadow: 0 2px 10px rgba(0,0,0,0.3);
z-index: 1000;
position: relative;
}
header h1 {
font-size: 1.5rem;
margin-bottom: 10px;
color: #e87424;
text-align: center;
}
.categories {
display: flex;
gap: 10px;
flex-wrap: wrap;
justify-content: center;
}
.categories button {
background: #e87424;
color: white;
border: none;
padding: 10px 20px;
border-radius: 25px;
cursor: pointer;
font-weight: bold;
transition: background 0.3s;
box-shadow: 0 2px 5px rgba(0,0,0,0.2);
font-size: 0.9rem;
flex: 1;
min-width: 100px;
}
.categories button:hover {
background: #ff914d;
}
.categories button.active {
background: #ff914d;
box-shadow: 0 4px 10px rgba(232, 116, 36, 0.5);
}
#map {
height: calc(100vh - 100px);
width: 100%;
position: absolute;
top: 100px;
left: 0;
}
#panel-info {
position: fixed;
right: 20px;
top: 120px;
background: white;
color: #333;
padding: 20px;
border-radius: 10px;
box-shadow: 0 5px 25px rgba(0,0,0,0.4);
max-width: 350px;
z-index: 1000;
transition: transform 0.3s;
}
#panel-info.hidden {
transform: translateX(400px);
}
#panel-info img {
width: 100%;
height: 200px;
object-fit: cover;
border-radius: 5px;
margin-bottom: 10px;
display: none;
}
#panel-info h2 {
margin-bottom: 5px;
color: #0f1a25;
font-size: 1.2rem;
}
#panel-rating {
color: #e87424;
margin-bottom: 10px;
}
#panel-address, #panel-phone {
margin-bottom: 5px;
font-size: 0.9rem;
}
#panel-website {
display: none;
margin: 10px 0;
color: #e87424;
text-decoration: none;
}
#panel-website:hover {
text-decoration: underline;
}
#panel-hours {
font-size: 0.9rem;
margin-bottom: 15px;
}
#route-btn {
background: #2196F3;
color: white;
border: none;
padding: 10px 20px;
border-radius: 5px;
cursor: pointer;
width: 100%;
font-weight: bold;
}
#route-btn:hover {
background: #1976D2;
}
#close-panel {
position: absolute;
top: 10px;
right: 10px;
background: none;
border: none;
font-size: 1.5rem;
cursor: pointer;
color: #666;
}
#close-panel:hover {
color: #000;
}
#route-panel {
position: fixed;
bottom: 20px;
left: 50%;
transform: translateX(-50%);
background: white;
color: #333;
padding: 15px 25px;
border-radius: 10px;
box-shadow: 0 5px 25px rgba(0,0,0,0.4);
z-index: 1000;
max-width: 500px;
text-align: center;
}
#route-panel.hidden {
display: none;
}
#route-summary {
margin: 10px 0;
font-weight: bold;
color: #0f1a25;
}
#open-gmaps {
display: inline-block;
background: #4CAF50;
color: white;
padding: 8px 16px;
border-radius: 5px;
text-decoration: none;
margin-top: 10px;
}
#open-gmaps:hover {
background: #45a049;
}
#close-route {
position: absolute;
top: 5px;
right: 10px;
background: none;
border: none;
font-size: 1.2rem;
cursor: pointer;
color: #666;
}
#close-route:hover {
color: #000;
}
#marker-form {
position: fixed;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background: white;
color: #333;
padding: 25px;
border-radius: 10px;
box-shadow: 0 10px 50px rgba(0,0,0,0.5);
z-index: 2000;
max-width: 400px;
width: 90%;
}
#marker-form.hidden {
display: none;
}
#marker-form h3 {
margin-bottom: 15px;
color: #0f1a25;
text-align: center;
}
#marker-form label {
display: block;
margin-bottom: 10px;
}
#marker-form label input,
#marker-form label textarea,
#marker-form label select {
width: 100%;
padding: 8px;
margin-top: 5px;
border: 1px solid #ddd;
border-radius: 5px;
font-family: inherit;
}
#marker-form button {
background: #e87424;
color: white;
border: none;
padding: 10px 20px;
border-radius: 5px;
cursor: pointer;
width: 100%;
margin-top: 10px;
font-weight: bold;
font-family: inherit;
}
#marker-form button:hover {
background: #ff914d;
}
#close-form {
position: absolute;
top: 10px;
right: 10px;
background: none;
border: none;
font-size: 1.5rem;
cursor: pointer;
color: #666;
}
#close-form:hover {
color: #000;
}
@media (max-width: 768px) {
header {
padding: 10px;
}
header h1 {
font-size: 1.2rem;
}
.categories {
flex-direction: column;
gap: 5px;
}
.categories button {
width: 100%;
padding: 8px;
font-size: 0.85rem;
}
#panel-info {
right: 10px;
top: 100px;
max-width: 90%;
}
#route-panel {
left: 10px;
right: 10px;
transform: none;
width: calc(100% - 20px);
}
}
@media (max-width: 480px) {
header h1 {
font-size: 1rem;
}
.categories button {
padding: 6px;
font-size: 0.8rem;
}
#panel-info {
top: 90px;
padding: 15px;
}
#panel-info h2 {
font-size: 1rem;
}
#panel-info img {
height: 150px;
}
}
</style>
</head>
<body>
<header>
<h1>üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø SCOTLAND GUIDE</h1>
<div class="categories">
<button data-cat="food" class="active">üçΩÔ∏è JAMAR</button>
<button data-cat="culture">üèõÔ∏è CULTURILLA</button>
<button data-cat="nature">üå≤ PASEITO</button>
</div>
</header>
<div id="map"></div>
<div id="panel-info" class="hidden">
<button id="close-panel">√ó</button>
<img id="panel-photo" src="" alt="">
<h2 id="panel-name"></h2>
<div id="panel-rating"></div>
<p id="panel-address"></p>
<p id="panel-phone"></p>
<a id="panel-website" target="_blank">üåê Web oficial</a>
<p id="panel-hours"></p>
<button id="route-btn">üß≠ CALCULAR RUTA</button>
</div>
<div id="route-panel" class="hidden">
<button id="close-route">√ó</button>
<h3>Ruta</h3>
<div id="route-summary"></div>
<a id="open-gmaps" target="_blank">üì± Abrir en Google Maps</a>
</div>
<div id="marker-form" class="hidden">
<button id="close-form">√ó</button>
<h3>üìç A√±adir marcador personalizado</h3>
<form id="custom-marker-form">
<label>
Nombre:
<input type="text" id="marker-name" required>
</label>
<label>
Descripci√≥n:
<textarea id="marker-desc" rows="3"></textarea>
</label>
<label>
URL Foto (opcional):
<input type="url" id="marker-photo">
</label>
<label>
Tel√©fono (opcional):
<input type="tel" id="marker-phone">
</label>
<label>
Web (opcional):
<input type="url" id="marker-web">
</label>
<label>
Categor√≠a:
<select id="marker-category">
<option value="personal">Personal</option>
<option value="favorito">Favorito</option>
<option value="nota">Nota</option>
</select>
</label>
<button type="submit">Guardar</button>
</form>
</div>
<script>
// Datos de destiler√≠as
const distilleries = [
{
name: "The Macallan",
location: { lat: 57.4638, lng: -3.1113 },
region: "Speyside",
description: "Destiler√≠a de lujo conocida por su whisky de malta single malt premium.",
founded: 1824,
website: "https://www.themacallan.com",
photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/The_Macallan_Distillery.jpg/800px-The_Macallan_Distillery.jpg"
},
{
name: "Glenfiddich",
location: { lat: 57.4494, lng: -3.1193 },
region: "Dufftown",
description: "La destiler√≠a m√°s visitada del mundo, pionera del single malt escoc√©s.",
founded: 1887,
website: "https://www.glenfiddich.com",
photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8c/Glenfiddich_Distillery.jpg/800px-Glenfiddich_Distillery.jpg"
},
{
name: "The Glenlivet",
location: { lat: 57.3206, lng: -3.2322 },
region: "Ballindalloch",
description: "Uno de los single malts m√°s famosos de Speyside, con sabor suave y afrutado.",
founded: 1824,
website: "https://www.theglenlivet.com",
photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Glenlivet_Distillery.jpg/800px-Glenlivet_Distillery.jpg"
},
{
name: "Lagavulin",
location: { lat: 55.6829, lng: -6.2258 },
region: "Islay",
description: "Whisky de Islay con sabor intenso a turba y humo, culto entre los aficionados.",
founded: 1816,
website: "https://www.lagavulin.com",
photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/Lagavulin_Distillery.jpg/800px-Lagavulin_Distillery.jpg"
},
{
name: "Laphroaig",
location: { lat: 55.6839, lng: -6.2411 },
region: "Islay",
description: "Famoso por su sabor medicinal y ahumado intenso, whisky de car√°cter fuerte.",
founded: 1815,
website: "https://www.laphroaig.com",
photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/7d/Laphroaig_Distillery.jpg/800px-Laphroaig_Distillery.jpg"
},
{
name: "Ardbeg",
location: { lat: 55.6787, lng: -6.2667 },
region: "Islay",
description: "Whisky de turba potente con notas de caf√© y chocolate, culto mundial.",
founded: 1815,
website: "https://www.ardbeg.com",
photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Ardbeg_Distillery.jpg/800px-Ardbeg_Distillery.jpg"
},
{
name: "Talisker",
location: { lat: 57.2894, lng: -6.3336 },
region: "Isle of Skye",
description: "√önica destiler√≠a de Skye, whisky marino con toques de pimienta y humo.",
founded: 1830,
website: "https://www.taliskerwhisky.com",
photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Talisker_Distillery.jpg/800px-Talisker_Distillery.jpg"
},
{
name: "Highland Park",
location: { lat: 58.9808, lng: -2.9639 },
region: "Orkney",
description: "La destiler√≠a m√°s septentrional de Escocia, whisky equilibrado con turba suave.",
founded: 1798,
website: "https://www.highlandparkwhisky.com",
photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Highland_Park_Distillery.jpg/800px-Highland_Park_Distillery.jpg"
},
{
name: "Oban",
location: { lat: 56.4147, lng: -5.4722 },
region: "Oban",
description: "Destiler√≠a urbana con whisky afrutado y ligeramente ahumado.",
founded: 1794,
website: "https://www.obanwhisky.com",
photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4b/Oban_Distillery.jpg/800px-Oban_Distillery.jpg"
},
{
name: "Dalwhinnie",
location: { lat: 57.0633, lng: -4.0456 },
region: "Dalwhinnie",
description: "Destiler√≠a m√°s alta de Escocia, whisky suave con notas de miel y brezo.",
founded: 1898,
website: "https://www.dalwhinnie.com",
photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/Dalwhinnie_Distillery.jpg/800px-Dalwhinnie_Distillery.jpg"
},
{
name: "Glenmorangie",
location: { lat: 57.8061, lng: -4.0503 },
region: "Tain",
description: "Conocida por sus stills m√°s altos de Escocia, whisky elegante y complejo.",
founded: 1843,
website: "https://www.glenmorangie.com",
photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6f/Glenmorangie_Distillery.jpg/800px-Glenmorangie_Distillery.jpg"
},
{
name: "Aberlour",
location: { lat: 57.3758, lng: -3.2214 },
region: "Aberlour",
description: "Whisky Speyside rico y dulce, madurado en barricas de Jerez y bourbon.",
founded: 1879,
website: "https://www.aberlour.com",
photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Aberlour_Distillery.jpg/800px-Aberlour_Distillery.jpg"
},
{
name: "Balvenie",
location: { lat: 57.4486, lng: -3.1206 },
region: "Dufftown",
description: "Una de las pocas destiler√≠as que a√∫n maltea su propia cebada, whisky artesanal.",
founded: 1892,
website: "https://www.balvenie.com",
photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/Balvenie_Distillery.jpg/800px-Balvenie_Distillery.jpg"
},
{
name: "Bowmore",
location: { lat: 55.7575, lng: -6.2656 },
region: "Islay",
description: "Destiler√≠a m√°s antigua de Islay, whisky equilibrado con turba y frutas.",
founded: 1779,
website: "https://www.bowmore.com",
photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2c/Bowmore_Distillery.jpg/800px-Bowmore_Distillery.jpg"
},
{
name: "Springbank",
location: { lat: 55.4303, lng: -5.5964 },
region: "Campbeltown",
description: "√öltima destiler√≠a tradicional de Campbeltown, proceso 100% manual.",
founded: 1828,
website: "https://www.springbankwhisky.com",
photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/Springbank_Distillery.jpg/800px-Springbank_Distillery.jpg"
}
];
// Variables globales
let map;
let userPosition = null;
let currentMarkers = [];
let customMarkers = [];
let infoWindow = null;
let directionsRenderer = null;
let directionsService = null;
let selectedPlace = null;
let currentCategory = 'food';
let tempCircle = null; // ‚≠ê NUEVA VARIABLE

// ‚ö†Ô∏è initMap debe estar en scope global ANTES de cargar Google Maps
window.initMap = function() {
// Pedir ubicaci√≥n del usuario
if (navigator.geolocation) {
navigator.geolocation.getCurrentPosition(
(position) => {
userPosition = {
lat: position.coords.latitude,
lng: position.coords.longitude
};
loadMap();
},
(error) => {
console.error('Error getting location:', error);
// Ubicaci√≥n por defecto (Edimburgo)
userPosition = { lat: 55.9533, lng: -3.1883 };
loadMap();
},
{ enableHighAccuracy: true, timeout: 10000 }
);
} else {
alert('Geolocalizaci√≥n no soportada');
userPosition = { lat: 55.9533, lng: -3.1883 };
loadMap();
}
};

// ‚≠ê FUNCI√ìN PARA LIMPIAR C√çRCULO TEMPORAL
function clearTempCircle() {
  if (tempCircle) {
    tempCircle.setMap(null);
    tempCircle = null;
  }
}

function loadMap() {
// Crear mapa centrado en usuario
map = new google.maps.Map(document.getElementById('map'), {
center: userPosition,
zoom: 13,
mapTypeControl: false,
streetViewControl: false,
fullscreenControl: true,
styles: [
{
featureType: 'water',
elementType: 'geometry',
stylers: [{ color: '#193341' }]
},
{
featureType: 'landscape',
elementType: 'geometry',
stylers: [{ color: '#2c5a3c' }]
},
{
featureType: 'road',
elementType: 'geometry',
stylers: [{ color: '#3a3a3a' }]
},
{
featureType: 'poi',
elementType: 'geometry',
stylers: [{ color: '#4a6a4a' }]
}
]
});

// InfoWindow para hover
infoWindow = new google.maps.InfoWindow({
maxWidth: 300
});

// Services
directionsService = new google.maps.DirectionsService();
directionsRenderer = new google.maps.DirectionsRenderer({
map: map,
suppressMarkers: true,
polylineOptions: {
strokeColor: '#e87424',
strokeWeight: 5,
strokeOpacity: 0.8
}
});

// ‚≠ê NUEVO FLUJO: CLICK ‚Üí C√çRCULO TEMPORAL
map.addListener('click', (event) => {
  clearTempCircle();
  tempCircle = new google.maps.Circle({
    strokeColor: '#FF0000',
    strokeOpacity: 0.8,
    strokeWeight: 2,
    fillColor: '#FF0000',
    fillOpacity: 0.35,
    map: map,
    center: event.latLng,
    radius: 15,
    clickable: true
  });

  google.maps.event.addListener(tempCircle, 'click', () => {
    showMarkerForm(event.latLng);
    clearTempCircle();
  });
});

// Cargar destiler√≠as
loadDistilleries();

// Cargar marcadores personalizados guardados
loadCustomMarkers();

// Eventos botones categor√≠as
document.querySelectorAll('.categories button').forEach(btn => {
btn.addEventListener('click', () => {
  clearTempCircle(); // ‚≠ê LIMPIAR
  document.querySelectorAll('.categories button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  currentCategory = btn.dataset.cat;
  loadCategoryPlaces();
});
});

// Evento cerrar panel
document.getElementById('close-panel').addEventListener('click', () => {
  document.getElementById('panel-info').classList.add('hidden');
  clearTempCircle(); // ‚≠ê LIMPIAR
});

// Evento cerrar ruta
document.getElementById('close-route').addEventListener('click', () => {
  document.getElementById('route-panel').classList.add('hidden');
  directionsRenderer.set('directions', null);
  clearTempCircle(); // ‚≠ê LIMPIAR
});

// Evento cerrar formulario
document.getElementById('close-form').addEventListener('click', () => {
  document.getElementById('marker-form').classList.add('hidden');
  clearTempCircle(); // ‚≠ê LIMPIAR
});

// Evento submit formulario
document.getElementById('custom-marker-form').addEventListener('submit', (e) => {
e.preventDefault();
saveCustomMarker();
});

// Bot√≥n ruta
document.getElementById('route-btn').addEventListener('click', () => {
  clearTempCircle(); // ‚≠ê LIMPIAR
  calculateRoute();
});

// Cargar categor√≠a inicial
setTimeout(() => {
loadCategoryPlaces();
}, 500);
}

// Cargar destiler√≠as est√°ticas
function loadDistilleries() {
// Icono botella whisky
const whiskyIcon = {
url: 'https://cdn-icons-png.flaticon.com/512/190/190945.png',
scaledSize: new google.maps.Size(32, 32),
anchor: new google.maps.Point(16, 32)
};
distilleries.forEach(dist => {
const marker = new google.maps.Marker({
position: dist.location,
map: map,
icon: whiskyIcon,
title: dist.name,
data: {
...dist,
type: 'distillery'
}
});
// Hover info
google.maps.event.addListener(marker, 'mouseover', () => {
const content = `
<div style="font-family: Arial; padding: 10px; min-width: 200px;">
<h3 style="margin: 0 0 5px 0; color: #8B4513;">ü•É ${dist.name}</h3>
<p style="margin: 0; font-size: 0.9rem; color: #666;">${dist.region}</p>
<p style="margin: 5px 0 0 0; font-size: 0.85rem;">${dist.description}</p>
</div>
`;
infoWindow.setContent(content);
infoWindow.open(map, marker);
});
google.maps.event.addListener(marker, 'mouseout', () => {
infoWindow.close();
});
// Clic ‚Üí panel completo
google.maps.event.addListener(marker, 'click', () => {
  clearTempCircle(); // ‚≠ê LIMPIAR
  showPlacePanel(dist);
});
currentMarkers.push(marker);
});
}

// Cargar lugares por categor√≠a (Places API)
function loadCategoryPlaces() {
// Limpiar marcadores anteriores (excepto destiler√≠as y personalizados)
currentMarkers.forEach(m => {
if (m.data && m.data.type !== 'distillery' && m.data.type !== 'custom') {
m.setMap(null);
}
});
currentMarkers = currentMarkers.filter(m =>
m.data && (m.data.type === 'distillery' || m.data.type === 'custom')
);
if (!userPosition) return;
const placesService = new google.maps.places.PlacesService(map);
let request;
switch (currentCategory) {
case 'food':
request = {
location: userPosition,
radius: 5000,
type: ['restaurant', 'bar', 'cafe']
};
break;
case 'culture':
request = {
location: userPosition,
radius: 5000,
type: ['museum', 'art_gallery', 'church']
};
break;
case 'nature':
request = {
location: userPosition,
radius: 5000,
keyword: 'hiking trail viewpoint nature park'
};
break;
}
placesService.nearbySearch(request, (results, status) => {
if (status === google.maps.places.PlacesServiceStatus.OK) {
results.forEach(place => {
addPlaceMarker(place);
});
} else {
console.error('Places API error:', status);
}
});
}

// A√±adir marcador de lugar
function addPlaceMarker(place) {
let icon;
switch (currentCategory) {
case 'food':
icon = {
url: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png',
scaledSize: new google.maps.Size(30, 30)
};
break;
case 'culture':
icon = {
url: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png',
scaledSize: new google.maps.Size(30, 30)
};
break;
case 'nature':
icon = {
url: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png',
scaledSize: new google.maps.Size(30, 30)
};
break;
}
const marker = new google.maps.Marker({
position: place.geometry.location,
map: map,
icon: icon,
title: place.name,
data: {
...place,
type: 'place',
category: currentCategory
}
});
// Hover info
google.maps.event.addListener(marker, 'mouseover', () => {
let content = `
<div style="font-family: Arial; padding: 10px; min-width: 200px;">
<h3 style="margin: 0 0 5px 0;">${place.name}</h3>
`;
if (place.rating) {
const stars = '‚≠ê'.repeat(Math.floor(place.rating)) + '‚òÜ'.repeat(5 - Math.floor(place.rating));
content += `<div style="color: #e87424; margin-bottom: 5px;">${stars} (${place.rating})</div>`;
}
if (place.photos && place.photos[0]) {
content += `<img src="${place.photos[0].getUrl({ maxWidth: 100, maxHeight: 100 })}" style="width: 100px; height: 100px; object-fit: cover; margin: 5px 0;">`;
}
if (place.vicinity) {
content += `<p style="margin: 5px 0 0 0; font-size: 0.85rem;">${place.vicinity}</p>`;
}
content += `</div>`;
infoWindow.setContent(content);
infoWindow.open(map, marker);
});
google.maps.event.addListener(marker, 'mouseout', () => {
infoWindow.close();
});
// Clic ‚Üí obtener detalles completos
google.maps.event.addListener(marker, 'click', () => {
  clearTempCircle(); // ‚≠ê LIMPIAR
  const placesService = new google.maps.places.PlacesService(map);
  placesService.getDetails({ placeId: place.place_id }, (details, status) => {
    if (status === google.maps.places.PlacesServiceStatus.OK) {
      showPlacePanel(details);
    }
  });
});
currentMarkers.push(marker);
}

// Mostrar panel lateral con info completa
function showPlacePanel(place) {
const panel = document.getElementById('panel-info');
// Nombre
document.getElementById('panel-name').textContent = place.name || '';
// Rating
const ratingEl = document.getElementById('panel-rating');
if (place.rating) {
const stars = '‚≠ê'.repeat(Math.floor(place.rating)) + '‚òÜ'.repeat(5 - Math.floor(place.rating));
ratingEl.innerHTML = `${stars} ${place.rating}/5 ${place.user_ratings_total ? `(${place.user_ratings_total} rese√±as)` : ''}`;
} else {
ratingEl.innerHTML = '';
}
// Direcci√≥n
document.getElementById('panel-address').textContent = place.vicinity || place.formatted_address || '';
// Tel√©fono
const phoneEl = document.getElementById('panel-phone');
if (place.international_phone_number) {
phoneEl.innerHTML = `üìû <a href="tel:${place.international_phone_number.replace(/\s/g, '')}">${place.international_phone_number}</a>`;
} else {
phoneEl.textContent = '';
}
// Web
const webEl = document.getElementById('panel-website');
if (place.website) {
webEl.href = place.website;
webEl.style.display = 'inline-block';
} else {
webEl.style.display = 'none';
}
// Horario
const hoursEl = document.getElementById('panel-hours');
if (place.opening_hours && place.opening_hours.weekday_text) {
hoursEl.innerHTML = `<strong>Horario:</strong><br>${place.opening_hours.weekday_text.slice(0, 3).join('<br>')}`;
} else {
hoursEl.textContent = '';
}
// Foto
const photoEl = document.getElementById('panel-photo');
if (place.photos && place.photos[0]) {
photoEl.src = place.photos[0].getUrl({ maxWidth: 400, maxHeight: 300 });
photoEl.style.display = 'block';
} else if (place.photo) {
const img = new Image();
img.onload = () => {
photoEl.src = place.photo;
photoEl.style.display = 'block';
};
img.onerror = () => {
photoEl.style.display = 'none';
};
img.src = place.photo;
} else {
photoEl.style.display = 'none';
}
// Guardar lugar seleccionado para ruta
selectedPlace = place;
// Mostrar panel
panel.classList.remove('hidden');
}

// Calcular ruta
function calculateRoute() {
if (!selectedPlace || !userPosition) return;
const destination = selectedPlace.geometry ? selectedPlace.geometry.location : new google.maps.LatLng(selectedPlace.location.lat, selectedPlace.location.lng);
directionsService.route({
origin: userPosition,
destination: destination,
travelMode: google.maps.TravelMode.DRIVING
}, (response, status) => {
if (status === google.maps.DirectionsStatus.OK) {
directionsRenderer.setDirections(response);
// Mostrar panel ruta
const route = response.routes[0].legs[0];
document.getElementById('route-summary').innerHTML = `
üìç ${route.distance.text} ‚Ä¢ ‚è±Ô∏è ${route.duration.text}
`;
// Enlace a Google Maps
const originStr = `${userPosition.lat},${userPosition.lng}`;
const destStr = `${destination.lat()},${destination.lng()}`;
document.getElementById('open-gmaps').href =
`https://www.google.com/maps/dir/?api=1&origin=${originStr}&destination=${destStr}&travelmode=driving`;
document.getElementById('route-panel').classList.remove('hidden');
} else {
alert('No se pudo calcular la ruta: ' + status);
}
});
}

// Formulario marcador personalizado
function showMarkerForm(latLng) {
document.getElementById('marker-form').classList.remove('hidden');
window.tempMarkerPosition = latLng;
}

function saveCustomMarker() {
const latLng = window.tempMarkerPosition;
if (!latLng) return;
const markerData = {
name: document.getElementById('marker-name').value,
description: document.getElementById('marker-desc').value,
photo: document.getElementById('marker-photo').value,
phone: document.getElementById('marker-phone').value,
website: document.getElementById('marker-web').value,
category: document.getElementById('marker-category').value,
position: {
lat: latLng.lat(),
lng: latLng.lng()
},
type: 'custom'
};
// Crear marcador
const marker = new google.maps.Marker({
position: latLng,
map: map,
icon: {
url: 'http://maps.google.com/mapfiles/ms/icons/yellow-dot.png',
scaledSize: new google.maps.Size(30, 30)
},
title: markerData.name,
data: markerData
});
// Hover info
google.maps.event.addListener(marker, 'mouseover', () => {
let content = `
<div style="font-family: Arial; padding: 10px; min-width: 200px;">
<h3 style="margin: 0 0 5px 0; color: #e87424;">üìç ${markerData.name}</h3>
`;
if (markerData.description) {
content += `<p style="margin: 5px 0 0 0; font-size: 0.85rem;">${markerData.description}</p>`;
}
if (markerData.photo) {
content += `<img src="${markerData.photo}" style="width: 100px; height: 100px; object-fit: cover; margin: 5px 0;">`;
}
content += `</div>`;
infoWindow.setContent(content);
infoWindow.open(map, marker);
});
google.maps.event.addListener(marker, 'mouseout', () => {
infoWindow.close();
});
// Clic ‚Üí panel completo
google.maps.event.addListener(marker, 'click', () => {
  clearTempCircle(); // ‚≠ê LIMPIAR
  showCustomMarkerPanel(markerData);
});
// Guardar en array
customMarkers.push(marker);
currentMarkers.push(marker);
// Guardar en LocalStorage
saveCustomMarkersToStorage();
// Cerrar formulario
document.getElementById('marker-form').classList.add('hidden');
document.getElementById('custom-marker-form').reset();
}

// Mostrar panel marcador personalizado
function showCustomMarkerPanel(data) {
const panel = document.getElementById('panel-info');
document.getElementById('panel-name').textContent = data.name;
document.getElementById('panel-rating').innerHTML = `<span style="color: #e87424;">üìç ${data.category}</span>`;
document.getElementById('panel-address').textContent = `Lat: ${data.position.lat}, Lng: ${data.position.lng}`;
const phoneEl = document.getElementById('panel-phone');
if (data.phone) {
phoneEl.innerHTML = `üìû <a href="tel:${data.phone.replace(/\s/g, '')}">${data.phone}</a>`;
} else {
phoneEl.textContent = '';
}
const webEl = document.getElementById('panel-website');
if (data.website) {
webEl.href = data.website;
webEl.style.display = 'inline-block';
} else {
webEl.style.display = 'none';
}
document.getElementById('panel-hours').textContent = data.description || '';
const photoEl = document.getElementById('panel-photo');
if (data.photo) {
photoEl.src = data.photo;
photoEl.style.display = 'block';
} else {
photoEl.style.display = 'none';
}
selectedPlace = {
geometry: {
location: new google.maps.LatLng(data.position.lat, data.position.lng)
}
};
panel.classList.remove('hidden');
}

// Guardar marcadores personalizados en LocalStorage
function saveCustomMarkersToStorage() {
const data = customMarkers.map(m => ({
name: m.data.name,
description: m.data.description,
photo: m.data.photo,
phone: m.data.phone,
website: m.data.website,
category: m.data.category,
position: {
lat: m.getPosition().lat(),
lng: m.getPosition().lng()
}
}));
localStorage.setItem('scotlandCustomMarkers', JSON.stringify(data));
}

// Cargar marcadores personalizados
function loadCustomMarkers() {
const saved = localStorage.getItem('scotlandCustomMarkers');
if (!saved) return;
try {
const data = JSON.parse(saved);
data.forEach(item => {
const marker = new google.maps.Marker({
position: item.position,
map: map,
icon: {
url: 'http://maps.google.com/mapfiles/ms/icons/yellow-dot.png',
scaledSize: new google.maps.Size(30, 30)
},
title: item.name,
data: {
...item,
type: 'custom'
}
});
// Hover info
google.maps.event.addListener(marker, 'mouseover', () => {
let content = `
<div style="font-family: Arial; padding: 10px; min-width: 200px;">
<h3 style="margin: 0 0 5px 0; color: #e87424;">üìç ${item.name}</h3>
`;
if (item.description) {
content += `<p style="margin: 5px 0 0 0; font-size: 0.85rem;">${item.description}</p>`;
}
if (item.photo) {
content += `<img src="${item.photo}" style="width: 100px; height: 100px; object-fit: cover; margin: 5px 0;">`;
}
content += `</div>`;
infoWindow.setContent(content);
infoWindow.open(map, marker);
});
google.maps.event.addListener(marker, 'mouseout', () => {
infoWindow.close();
});
// Clic ‚Üí panel
google.maps.event.addListener(marker, 'click', () => {
  clearTempCircle(); // ‚≠ê LIMPIAR
  showCustomMarkerPanel(item);
});
customMarkers.push(marker);
currentMarkers.push(marker);
});
} catch (e) {
console.error('Error loading custom markers:', e);
}
}

// ‚≠ê ELIMINADO: long-press y latLngFromPixel (ya no necesarios)
</script>
<!-- ‚ö†Ô∏è REEMPLAZA TU_API_KEY POR TU CLAVE REAL DE GOOGLE CLOUD ‚ö†Ô∏è -->
<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCE0XidfuLtjrNgNenKnpqq6lq1F0CTYUs&libraries=places&callback=initMap">
</script>
</body>
</html>
