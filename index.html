<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ü•É Escocia: Gu√≠a Interactiva</title>
<!-- Google Maps JavaScript API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCE0XidfuLtjrNgNenKnpqq6lq1F0CTYUs&libraries=places"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif;background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="400" viewBox="0 0 400 400"><rect width="400" height="400" fill="%233e2723"/><path d="M0 0 L400 400 M0 100 L300 400 M0 200 L200 400 M0 300 L100 400 M100 0 L400 300 M200 0 L400 200 M300 0 L400 100" stroke="%235d4037" stroke-width="2" opacity="0.3"/></svg>');background-size:cover;background-attachment:fixed;color:#fff;line-height:1.5;position:relative}body::before{content:"";position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(45deg,rgba(180,30,30,0.08)25%,transparent 25%,transparent 75%,rgba(180,30,30,0.08)75%),linear-gradient(135deg,rgba(180,30,30,0.08)25%,transparent 25%,transparent 75%,rgba(180,30,30,0.08)75%);background-size:40px 40px;pointer-events:none;z-index:-1}header{background:linear-gradient(135deg,rgba(62,39,35,0.95),rgba(30,15,15,0.95));padding:1rem;text-align:center;box-shadow:0 4px 20px rgba(0,0,0,0.7);border-bottom:3px solid #c62828;position:relative;z-index:100}h1{font-size:1.8rem;margin-bottom:0.3rem;color:#d4af37;text-shadow:2px 2px 4px rgba(0,0,0,0.8);letter-spacing:1px;font-weight:bold}.subtitle{font-size:0.95rem;color:#ecf0f1;opacity:0.9;margin-top:0.3rem}.container{max-width:100%;margin:0 auto;padding:0.8rem;gap:1rem}.search-container{position:relative;margin-bottom:0.8rem}.search-box{width:100%;padding:12px 16px;background:rgba(30,15,15,0.9);border:2px solid #d4af37;border-radius:12px;color:white;font-size:1rem;outline:none;transition:all 0.3s}.search-box:focus{border-color:#c62828;box-shadow:0 0 15px rgba(212,175,55,0.5)}.search-box::placeholder{color:#b0bec5}#map-container{position:relative;background:rgba(30,15,15,0.7);border-radius:10px;overflow:hidden;box-shadow:0 5px 25px rgba(0,0,0,0.8);border:3px solid #8b0000}#map{height:60vh;min-height:300px;width:100%;border-radius:8px}.action-buttons-popup{background:linear-gradient(135deg,rgba(44,62,80,0.95),rgba(30,40,50,0.95));border-radius:16px;padding:1rem;box-shadow:0 10px 30px rgba(0,0,0,0.7);border:3px solid #5d4037;display:flex;flex-direction:column;gap:0.9rem;min-width:220px;position:absolute;z-index:1000;animation:popupSlide 0.3s ease-out;touch-action:manipulation}@keyframes popupSlide{from{opacity:0;transform:translateY(-15px)}to{opacity:1;transform:translateY(0)}}.btn-action{padding:1.3rem 1.5rem;border:none;border-radius:14px;font-size:1.3rem;font-weight:bold;cursor:pointer;transition:all 0.2s ease;color:white;text-shadow:1px 1px 2px rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;gap:0.7rem;min-height:56px;touch-action:manipulation}.btn-jamar{background:linear-gradient(135deg,#c62828,#8b0000);border:3px solid #d32f2f}.btn-culturilla{background:linear-gradient(135deg,#1565c0,#0d47a1);border:3px solid #1976d2}.btn-paseito{background:linear-gradient(135deg,#2e7d32,#1b5e20);border:3px solid #388e3c}.btn-action:hover{transform:scale(1.03);box-shadow:0 6px 20px rgba(0,0,0,0.6)}.btn-action:active{transform:scale(0.97)}.info-panel{background:linear-gradient(135deg,rgba(44,62,80,0.95),rgba(30,40,50,0.95));border-radius:16px;padding:1.5rem;box-shadow:0 8px 25px rgba(0,0,0,0.6);border:3px solid #5d4037;margin-top:0.5rem}.panel-title{font-size:1.6rem;color:#d4af37;margin-bottom:1.2rem;text-align:center;border-bottom:3px solid #d4af37;padding-bottom:0.7rem;font-weight:bold}.info-content{display:none}.info-content.active{display:block;animation:fadeIn 0.4s ease}@keyframes fadeIn{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}.items-list{display:flex;flex-direction:column;gap:1.3rem;margin-top:1.2rem}.item{background:rgba(62,39,35,0.8);padding:1.4rem;border-radius:14px;border-left:6px solid #d4af37;transition:all 0.25s ease;box-shadow:0 4px 12px rgba(0,0,0,0.45);touch-action:manipulation}.item:hover{transform:translateX(6px);background:rgba(78,52,46,0.85);box-shadow:0 6px 18px rgba(0,0,0,0.55)}.item-title{font-size:1.35rem;font-weight:bold;color:#fff;margin-bottom:0.9rem;display:flex;align-items:center;gap:0.6rem}.item-image{width:100%;height:180px;object-fit:cover;border-radius:12px;margin-bottom:1rem;box-shadow:0 4px 10px rgba(0,0,0,0.5);display:block}.item-desc{font-size:0.98rem;color:#f8f9fa;opacity:0.95;margin-bottom:1rem;line-height:1.55}.item-details{display:flex;flex-direction:column;gap:0.7rem;margin-top:0.9rem}.item-detail{display:flex;align-items:flex-start;gap:0.7rem;font-size:0.95rem}.item-link{display:inline-block;margin-top:0.9rem;color:#4da6ff;text-decoration:none;font-weight:bold;transition:all 0.25s;padding:0.6rem 1rem;border-radius:10px;background:rgba(77,166,255,0.12);width:fit-content;font-size:1.05rem;touch-action:manipulation}.item-link:hover{background:rgba(77,166,255,0.25);transform:translateX(4px);color:#64b5f6}.item-extra{font-size:0.88rem;color:#cfd8dc;margin-top:0.7rem;font-style:italic;padding-top:0.7rem;border-top:1px solid rgba(255,255,255,0.12)}.contact-info{background:rgba(0,0,0,0.35);padding:1rem;border-radius:10px;margin-top:0.9rem;font-size:0.95rem;border:1px solid rgba(255,255,255,0.1)}.contact-info div{margin-bottom:0.5rem;display:flex;align-items:flex-start;gap:0.7rem;flex-wrap:wrap}.contact-info a{color:#4da6ff;text-decoration:underline}.footer{text-align:center;padding:1.2rem;background:rgba(30,15,15,0.85);border-top:3px solid #8b0000;margin-top:1rem;font-size:0.85rem;color:#bdc3c7;line-height:1.5}.btn-favorite{background:transparent;border:none;font-size:1.8rem;padding:5px;cursor:pointer;flex-shrink:0;transition:transform 0.2s ease}.btn-favorite:hover{transform:scale(1.3)}.btn-favorite.favorited{color:#ffd700;text-shadow:0 0 8px rgba(255,215,0,0.7)}.note-input{width:100%;min-height:60px;background:rgba(30,15,15,0.7);color:white;border:1px solid #5d4037;border-radius:6px;padding:8px;margin-top:8px;font-size:0.95rem;resize:vertical}.note-input:focus{outline:2px solid #d4af37;background:rgba(40,20,20,0.8)}.btn-streetview,.btn-directions{background:linear-gradient(135deg,#5d4037,#3e2723);border:2px solid #d4af37;color:white;padding:8px 12px;border-radius:8px;font-size:0.9rem;margin-top:8px;cursor:pointer;transition:all 0.2s;display:inline-block;width:48%}.btn-streetview:hover,.btn-directions:hover{background:linear-gradient(135deg,#6d4c41,#4e342e);transform:translateY(-2px)}.btn-streetview{margin-right:4%}.header-buttons{display:flex;justify-content:center;gap:10px;margin-top:8px}.btn-mylist{background:#d4af37;color:#3e2723;padding:6px 14px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;font-size:0.9rem;transition:all 0.2s}.btn-mylist:hover{background:#c6a028;transform:scale(1.05)}@media(max-width:480px){h1{font-size:1.6rem}.subtitle{font-size:0.85rem}#map{height:55vh;min-height:280px}.btn-action{padding:1.4rem 1.2rem;font-size:1.25rem;min-height:60px}.action-buttons-popup{min-width:240px;border-radius:18px;padding:0.8rem}.item-image{height:160px}.item{padding:1.3rem;border-radius:16px}.panel-title{font-size:1.5rem}.contact-info{padding:0.9rem;font-size:0.9rem}.footer{padding:1rem;font-size:0.8rem}.btn-streetview,.btn-directions{width:100%;margin-right:0;margin-top:6px}}@media(min-width:769px){.items-list{grid-template-columns:repeat(auto-fill,minmax(350px,1fr));grid-auto-rows:auto}}
</style>
</head>
<body>
<header>
<h1>üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø ESCOCIA INTERACTIVA üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø</h1>
<div class="subtitle">Explora las 17 mejores localidades, 10 destiler√≠as y experiencias</div>
<div class="header-buttons">
<button class="btn-mylist" onclick="showMyList()">üìã Mi Lista</button>
</div>
</header>

<div class="container">
<div class="search-container">
<input type="text" id="search-box" class="search-box" placeholder="üîç Busca una localidad...">
</div>
<div id="map-container"><div id="map"></div></div>
<div class="info-panel" id="info-panel">
<h2 class="panel-title" id="panel-title">Selecciona una localidad en el mapa</h2>
<div id="info-content" class="info-content active">
<p style="text-align:center;font-size:1.15rem;color:#e0e0e0;padding:1.8rem;line-height:1.6">
üìç <strong>Pincha en cualquier localidad</strong> para ver opciones<br>
ü•É <strong>Pincha en una botella</strong> para info de la destiler√≠a<br>
<small style="display:block;margin-top:1rem;font-size:0.95rem;color:#b0bec5">üí° Consejo: Usa dos dedos para mover el mapa en m√≥viles</small>
</p>
</div>
</div>
</div>

<div class="footer">
<p>Gu√≠a interactiva de Escocia ‚Ä¢ Whisky, Naturaleza, Cultura y Gastronom√≠a<br>
<small>Dise√±ado para m√≥viles ‚Ä¢ Desliza para explorar ‚Ä¢ Toca los botones para m√°s info</small></p>
</div>

<script>
// ========== DATOS COMPLETOS ==========
const localidadesData = {
"Edimburgo": {
jamar: [
{name:"The Witchery by the Castle",desc:"Restaurante g√≥tico de lujo con decoraci√≥n opulenta y cocina escocesa premium.",image:"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=600",address:"352 Castlehill, Royal Mile, EH1 2NF",phone:"+44 131 225 5432",web:"https://www.thewitchery.com",extra:"‚≠ê Michelin ‚Ä¢ Cena rom√°ntica"},
{name:"Whiski Rooms",desc:"Pub con m√°s de 350 whiskies escoceses y cocina tradicional. Ambiente acogedor con chimenea.",image:"https://images.unsplash.com/photo-1551334787-29b7266b0b30?w=600",address:"119 High St, Royal Mile, EH1 1SG",phone:"+44 131 226 1599",web:"https://www.thewhiskirooms.com",extra:"ü•É Whisky bar ‚Ä¢ Men√∫ escoc√©s"},
{name:"Ondine",desc:"Mariscos frescos directos del mar del Norte. Ostras, langosta y pescado del d√≠a.",image:"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=600",address:"25 George IV Bridge, EH1 3EZ",phone:"+44 131 226 5111",web:"https://www.ondine.co.uk",extra:"ü¶û Marisquer√≠a ‚Ä¢ Ostras frescas"},
{name:"The Scran & Scallie",desc:"Gastropub moderno de chefs galardonados. Comida escocesa con toque contempor√°neo.",image:"https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=600",address:"1 Comely Bank Rd, EH4 1DT",phone:"+44 131 332 7667",web:"https://www.thescranandscallie.co.uk",extra:"üç∫ Pub gourmet ‚Ä¢ Chef Michelin"},
{name:"Dishoom Edinburgh",desc:"Cocina india inspirada en los Irani caf√©s de Bombay. Desayunos legendarios.",image:"https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=600",address:"4a St Andrew Square, EH2 2BD",phone:"+44 131 260 6888",web:"https://www.dishoom.com/edinburgh",extra:"üå∂Ô∏è Comida india ‚Ä¢ Ambiente retro"}
],
culturilla: [
{name:"Castillo de Edimburgo",desc:"Fortaleza hist√≥rica con 900 a√±os de historia, residencia de Mar√≠a Estuardo y vistas panor√°micas.",image:"https://images.unsplash.com/photo-1534447677768-be436bb09401?w=800",link:"https://www.edinburghcastle.gov.uk",extra:"‚è∞ 9:30-18:00 ‚Ä¢ Entrada: ¬£19.50"},
{name:"Royal Mile",desc:"Calle principal medieval que conecta el Castillo con el Palacio de Holyroodhouse.",image:"https://images.unsplash.com/photo-1534447677768-be436bb09401?w=800",link:"https://www.visitscotland.com/info/towns-villages/royal-mile-p937311",extra:"üö∂ Calle peatonal ‚Ä¢ 1.8km"},
{name:"Palacio de Holyroodhouse",desc:"Residencia oficial de la realeza brit√°nica en Escocia. Conocido por los apartamentos de Mar√≠a Estuardo.",image:"https://images.unsplash.com/photo-1564581184201-9c4c5e8c8c7a?w=800",link:"https://www.royal.uk/royal-residences-palace-holyroodhouse",extra:"üëë Residencia real ‚Ä¢ Jardines hist√≥ricos"}
],
paseito: [
{name:"Arthur's Seat",desc:"Volc√°n extinto en Holyrood Park. Sendero de 2 horas con vistas espectaculares de toda Edimburgo.",image:"https://images.unsplash.com/photo-1534447677768-be436bb09401?w=800",link:"https://www.visitscotland.com/info/see-do/arthur-seat-p889711",extra:"ü•æ Moderada ‚Ä¢ 2-3h"}
]
}
// ... (contin√∫a con el resto de localidadesData del archivo anterior)
};

const destileriasData = [
{name:"Glenfiddich",coords:[57.352,-3.097],desc:"üìç Dufftown, Speyside ‚Ä¢ üè≠ 1887 ‚Ä¢ ü•É Speyside single malt ‚Ä¢ El nombre significa 'Valle de los Ciervos'. Whiskies suaves con notas de pera. ‚Ä¢ üåê glenfiddich.com"},
{name:"Macallan",coords:[57.328,-3.1],desc:"üìç Craigellachie, Speyside ‚Ä¢ üè≠ 1824 ‚Ä¢ ü•É Speyside sherry oak ‚Ä¢ Barricas de roble espa√±ol. Destiler√≠a con arquitectura espectacular. ‚Ä¢ üåê themacallan.com"},
{name:"Laphroaig",coords:[55.675,-6.303],desc:"üìç Islay ‚Ä¢ üè≠ 1815 ‚Ä¢ ü•É Islay heavily peated ‚Ä¢ Whisky m√°s ahumado y medicinal. Favorito del Pr√≠ncipe Carlos. ‚Ä¢ üåê laphroaig.com"},
{name:"Ardbeg",coords:[55.68,-6.3],desc:"üìç Islay ‚Ä¢ üè≠ 1815 ‚Ä¢ ü•É Islay peated ‚Ä¢ Casi cerr√≥ en los 80, rescatada en 1997. Notas de lim√≥n y sal marina. ‚Ä¢ üåê ardbeg.com"},
{name:"Talisker",coords:[57.286,-6.4],desc:"üìç Isla de Skye ‚Ä¢ üè≠ 1830 ‚Ä¢ ü•É Island maritime ‚Ä¢ √önica destiler√≠a de Skye. Notas marinas, ahumado y pimienta negra. ‚Ä¢ üåê malts.com/talisker"},
{name:"Oban",coords:[56.414,-5.471],desc:"üìç Oban ‚Ä¢ üè≠ 1794 ‚Ä¢ ü•É West Highland ‚Ä¢ Peque√±a destiler√≠a en medio de la ciudad. Car√°cter marino y afrutado. ‚Ä¢ üåê malts.com/oban"},
{name:"Highland Park",coords:[58.983,-2.96],desc:"üìç Kirkwall, Orkney ‚Ä¢ üè≠ 1798 ‚Ä¢ ü•É Orkney lightly peated ‚Ä¢ Combina turba local con roble espa√±ol. Notas de miel y brezo. ‚Ä¢ üåê highlandparkwhisky.com"},
{name:"Glenlivet",coords:[57.31,-3.24],desc:"üìç Ballindalloch, Speyside ‚Ä¢ üè≠ 1824 ‚Ä¢ ü•É Speyside ‚Ä¢ Pionera legal en Speyside. Whiskies suaves, afrutados y accesibles. ‚Ä¢ üåê theglenlivet.com"},
{name:"Dalwhinnie",coords:[56.97,-4.08],desc:"üìç Dalwhinnie, Highlands ‚Ä¢ üè≠ 1897 ‚Ä¢ ü•É Highland ‚Ä¢ Destiler√≠a m√°s alta de Escocia (352m). Notas de miel y brezo. ‚Ä¢ üåê malts.com/dalwhinnie"},
{name:"Lagavulin",coords:[55.677,-6.31],desc:"üìç Islay ‚Ä¢ üè≠ 1816 ‚Ä¢ ü•É Islay heavily peated ‚Ä¢ 'El Malt de los Malts'. Intensamente ahumado y complejo. ‚Ä¢ üåê malts.com/lagavulin"}
];

const localidadesCoords = {
"Edimburgo":[55.9533,-3.1883],"Glasgow":[55.8642,-4.2518],"St Andrews":[56.3397,-2.7977],"Inverness":[57.4778,-4.2247],
"Portree (Skye)":[57.4127,-6.1914],"Oban":[56.4153,-5.4702],"Fort William":[56.8487,-5.1053],
"Glencoe":[56.6826,-5.103],"Pitlochry":[56.7009,-3.7333],"Stirling":[56.1165,-3.9369],
"Aviemore":[57.197,-3.83],"Tobermory (Mull)":[56.6233,-6.0689],"Dundee":[56.462,-2.9707],
"Perth":[56.395,-3.433],"Aberdeen":[57.1497,-2.0943],"Fort Augustus":[57.1533,-4.6783],
"Ullapool":[57.8972,-5.1533]
};

// ========== GOOGLE MAPS INICIALIZACI√ìN ==========
let map;
let actionButtonsDiv = null;
let autocomplete;

function initMap() {
map = new google.maps.Map(document.getElementById('map'), {
center: { lat: 56.8, lng: -4.2 },
zoom: 7.5,
mapTypeControl: true,
zoomControl: true,
streetViewControl: true,
fullscreenControl: true,
styles: [
{featureType:"water",stylers:[{color:"#19a0d8"}]},
{featureType:"landscape",stylers:[{color:"#2c3e50"}]},
{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#2c3e50"}]},
{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#2c3e50"}]},
{featureType:"road.local",elementType:"geometry",stylers:[{color:"#34495e"}]},
{featureType:"poi",elementType:"geometry",stylers:[{color:"#2c3e50"}]},
{featureType:"transit",stylers:[{color:"#34495e"}]},
{elementType:"labels.text.fill",stylers:[{color:"#ecf0f1"}]},
{elementType:"labels.text.stroke",stylers:[{color:"#2c3e50"}]}
]
});

// A√±adir marcadores de localidades
Object.entries(localidadesCoords).forEach(([name, coords]) => {
const marker = new google.maps.Marker({
position: { lat: coords[0], lng: coords[1] },
map: map,
label: {
text: name,
color: '#3e2723',
fontWeight: 'bold',
fontSize: '12px'
},
icon: {
path: google.maps.SymbolPath.CIRCLE,
scale: 12,
fillColor: '#d4af37',
fillOpacity: 1,
strokeColor: '#3e2723',
strokeWeight: 2,
strokeOpacity: 1
},
title: name
});

marker.addListener('click', function(e) {
showActionButtons(name, coords[0], coords[1], e.latLng);
});
});

// A√±adir marcadores de destiler√≠as
destileriasData.forEach(dest => {
const marker = new google.maps.Marker({
position: { lat: dest.coords[0], lng: dest.coords[1] },
map: map,
icon: {
path: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z',
scale: 0.8,
fillColor: '#c62828',
fillOpacity: 1,
strokeColor: '#8b0000',
strokeWeight: 2,
strokeOpacity: 1,
anchor: new google.maps.Point(12, 20)
},
title: dest.name
});

const infowindow = new google.maps.InfoWindow({
content: `<strong>${dest.name}</strong><br><span style="font-size:13px;line-height:1.5">${dest.desc}</span>`,
maxWidth: 300
});

marker.addListener('click', function() {
infowindow.open(map, marker);
});
});

// Autocomplete de b√∫squeda
const input = document.getElementById('search-box');
autocomplete = new google.maps.places.Autocomplete(input);
autocomplete.bindTo('bounds', map);

autocomplete.addListener('place_changed', function() {
const place = autocomplete.getPlace();
if (place.geometry) {
map.panTo(place.geometry.location);
map.setZoom(12);
}
});
}

// ========== FUNCIONES DE FAVORITOS Y NOTAS (localStorage) ==========
function toggleFavorite(localidad, category, placeName) {
const key = `favorites_${localidad}_${category}_${placeName}`;
const isFav = localStorage.getItem(key);

if (isFav) {
localStorage.removeItem(key);
} else {
localStorage.setItem(key, JSON.stringify({
localidad,
category,
placeName,
timestamp: Date.now()
}));
}

// Actualizar icono en el panel actual si est√° abierto
showInfo(localidad, category);
}

function isFavorite(localidad, category, placeName) {
return localStorage.getItem(`favorites_${localidad}_${category}_${placeName}`);
}

function saveNote(localidad, category, placeName, text) {
const key = `note_${localidad}_${category}_${placeName}`;
if (text.trim() === '') {
localStorage.removeItem(key);
} else {
localStorage.setItem(key, text);
}
}

function getNote(localidad, category, placeName) {
return localStorage.getItem(`note_${localidad}_${category}_${placeName}`) || '';
}

function showMyList() {
const panelTitle = document.getElementById('panel-title');
const infoContent = document.getElementById('info-content');

panelTitle.innerHTML = 'üìã <span style="color:#d4af37">MI LISTA DE FAVORITOS</span>';

// Obtener todos los favoritos del localStorage
const favorites = [];
for (let i = 0; i < localStorage.length; i++) {
const key = localStorage.key(i);
if (key.startsWith('favorites_')) {
const data = JSON.parse(localStorage.getItem(key));
favorites.push(data);
}
}

// Ordenar por timestamp (m√°s recientes primero)
favorites.sort((a, b) => b.timestamp - a.timestamp);

let html = '<div class="items-list">';

if (favorites.length === 0) {
html += '<div style="text-align:center;padding:40px;color:#b0bec5;font-size:1.1rem">No tienes favoritos a√∫n. ‚≠ê<br><small style="display:block;margin-top:10px;font-size:0.9rem">Pincha en ‚òÜ para a√±adir lugares</small></div>';
} else {
favorites.forEach(fav => {
const note = getNote(fav.localidad, fav.category, fav.placeName);

html += `<div class="item" style="border-left:6px solid #d4af37">
<div style="display:flex;justify-content:space-between;align-items:start;gap:10px">
<div class="item-title">‚≠ê ${fav.placeName}</div>
<small style="color:#b0bec5;white-space:nowrap">${fav.localidad}</small>
</div>

<div style="margin-top:10px;font-size:0.95rem;color:#f8f9fa">
<strong>Categor√≠a:</strong> ${fav.category === 'jamar' ? 'üçΩÔ∏è JAMAR' : fav.category === 'culturilla' ? 'üèõÔ∏è CULTURILLA' : 'ü•æ PASEITO'}
</div>`;

if (note) {
html += `<div style="margin-top:15px;padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;border-left:4px solid #d4af37">
<strong style="color:#d4af37;font-size:0.95rem">üìù Mis notas:</strong>
<div style="margin-top:8px;color:#e0e0e0;font-size:0.95rem">${note.replace(/\n/g, '<br>')}</div>
</div>`;
}

html += `<button onclick='removeFromList("${fav.localidad}","${fav.category}","${fav.placeName.replace(/"/g, '&quot;')}", this)' 
style="margin-top:15px;background:#c62828;color:white;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;width:100%;font-size:0.95rem">
‚ùå Eliminar de favoritos
</button>
</div>`;
}
}
}

html += '</div>';
infoContent.innerHTML = html;
infoContent.classList.add('active');

setTimeout(() => {
document.getElementById('info-panel').scrollIntoView({ behavior: 'smooth', block: 'start' });
}, 100);
}

function removeFromList(localidad, category, placeName, button) {
if (!confirm('¬øEliminar de favoritos?')) return;

// Eliminar favorito y nota
localStorage.removeItem(`favorites_${localidad}_${category}_${placeName}`);
localStorage.removeItem(`note_${localidad}_${category}_${placeName}`);

// Eliminar visualmente
const itemDiv = button.closest('.item');
if (itemDiv) {
itemDiv.style.opacity = '0';
itemDiv.style.transform = 'translateX(20px)';
setTimeout(() => {
itemDiv.remove();

// Si no quedan favoritos, mostrar mensaje
let remaining = 0;
for (let i = 0; i < localStorage.length; i++) {
if (localStorage.key(i).startsWith('favorites_')) remaining++;
}

if (remaining === 0) {
showMyList(); // Recargar panel
}
}, 300);
}
}

// ========== FUNCIONES DE MAPA Y ACCIONES ==========
function showActionButtons(localidadName, lat, lng, latLng) {
// Eliminar botones anteriores si existen
if (actionButtonsDiv) {
document.body.removeChild(actionButtonsDiv);
actionButtonsDiv = null;
}

// Crear contenedor de botones
actionButtonsDiv = document.createElement('div');
actionButtonsDiv.className = 'action-buttons-popup';

// Posici√≥n relativa al mapa
const mapContainer = document.getElementById('map-container');
const mapRect = mapContainer.getBoundingClientRect();
const point = map.getProjection().fromLatLngToPoint(latLng);
const scale = Math.pow(2, map.getZoom());
const pixelX = Math.floor(point.x * scale - map.getBounds().getNorthEast().lng() * scale);
const pixelY = Math.floor(point.y * scale - map.getBounds().getSouthWest().lat() * scale);

// Calcular posici√≥n en pantalla
const containerWidth = mapContainer.offsetWidth;
const containerHeight = mapContainer.offsetHeight;
const leftPos = Math.min(Math.max(pixelX - 100, 10), containerWidth - 230);
const topPos = Math.min(Math.max(pixelY - 180, 10), containerHeight - 250);

actionButtonsDiv.style.left = leftPos + 'px';
actionButtonsDiv.style.top = topPos + 'px';
actionButtonsDiv.style.position = 'absolute';
actionButtonsDiv.style.zIndex = '1000';

actionButtonsDiv.innerHTML = `
<button class="btn-action btn-jamar" onclick="showInfo('${localidadName}','jamar')">
üçΩÔ∏è JAMAR
</button>
<button class="btn-action btn-culturilla" onclick="showInfo('${localidadName}','culturilla')">
üèõÔ∏è CULTURILLA
</button>
<button class="btn-action btn-paseito" onclick="showInfo('${localidadName}','paseito')">
ü•æ PASEITO
</button>
<button class="btn-streetview" onclick="showStreetView(${lat}, ${lng})">
üëÅÔ∏è Street View
</button>
<button class="btn-directions" onclick="showDirections(${lat}, ${lng})">
üöó C√≥mo llegar
</button>
`;

mapContainer.appendChild(actionButtonsDiv);

// Cerrar al hacer clic fuera
document.addEventListener('click', closeActionButtonsOnClickOutside);
}

function closeActionButtonsOnClickOutside(e) {
if (actionButtonsDiv && !actionButtonsDiv.contains(e.target) && !e.target.closest('.action-buttons-popup')) {
document.body.removeChild(actionButtonsDiv);
actionButtonsDiv = null;
document.removeEventListener('click', closeActionButtonsOnClickOutside);
}
}

function showStreetView(lat, lng) {
const streetViewDiv = document.createElement('div');
streetViewDiv.id = 'streetview-modal';
streetViewDiv.style.cssText = `
position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
background: rgba(0,0,0,0.9); z-index: 9999; display: flex; 
flex-direction: column; align-items: center; justify-content: center;
`;

const closeBtn = document.createElement('button');
closeBtn.innerHTML = '‚ùå Cerrar Street View';
closeBtn.style.cssText = `
background: #c62828; color: white; border: none; padding: 12px 24px; 
border-radius: 8px; font-size: 1.1rem; cursor: pointer; margin-bottom: 20px;
`;
closeBtn.onclick = () => document.body.removeChild(streetViewDiv);

const panorama = document.createElement('div');
panorama.id = 'panorama';
panorama.style.width = '90%';
panorama.style.height = '80%';
panorama.style.borderRadius = '10px';
panorama.style.boxShadow = '0 10px 40px rgba(0,0,0,0.8)';

streetViewDiv.appendChild(closeBtn);
streetViewDiv.appendChild(panorama);
document.body.appendChild(streetViewDiv);

// Cargar Street View
new google.maps.StreetViewPanorama(panorama, {
position: { lat: lat, lng: lng },
pov: { heading: 0, pitch: 0 },
zoom: 1
});
}

function showDirections(lat, lng) {
if (!navigator.geolocation) {
alert('Tu navegador no soporta geolocalizaci√≥n');
return;
}

navigator.geolocation.getCurrentPosition(
position => {
const origin = { lat: position.coords.latitude, lng: position.coords.longitude };
const destination = { lat: lat, lng: lng };

const directionsService = new google.maps.DirectionsService();
const directionsRenderer = new google.maps.DirectionsRenderer({
map: map,
draggable: true,
panel: document.getElementById('info-content')
});

directionsService.route({
origin: origin,
destination: destination,
travelMode: 'DRIVING'
}, (result, status) => {
if (status === 'OK') {
directionsRenderer.setDirections(result);
const panelTitle = document.getElementById('panel-title');
panelTitle.innerHTML = 'üöó <span style="color:#d4af37">RUTA</span>';
document.getElementById('info-content').classList.add('active');

// Centrar mapa en la ruta
const bounds = new google.maps.LatLngBounds();
result.routes[0].legs[0].steps.forEach(step => {
bounds.extend(step.start_location);
bounds.extend(step.end_location);
});
map.fitBounds(bounds);
} else {
alert('No se pudo calcular la ruta: ' + status);
}
});
},
error => {
alert('No se pudo obtener tu ubicaci√≥n. Permite el acceso a la ubicaci√≥n.');
},
{ enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
);
}

// ========== FUNCI√ìN PRINCIPAL showInfo (CORREGIDA) ==========
window.showInfo = function(localidadName, category) {
const panelTitle = document.getElementById('panel-title');
const infoContent = document.getElementById('info-content');

let categoryText = '', emoji = '';
if (category === 'jamar') { categoryText = 'üçΩÔ∏è JAMAR'; emoji = 'üçΩÔ∏è'; }
if (category === 'culturilla') { categoryText = 'üèõÔ∏è CULTURILLA'; emoji = 'üèõÔ∏è'; }
if (category === 'paseito') { categoryText = 'ü•æ PASEITO'; emoji = 'ü•æ'; }

panelTitle.innerHTML = `${categoryText} en <span style="color:#c62828">${localidadName}</span>`;

const items = localidadesData[localidadName][category];
let html = '<div class="items-list">';

items.forEach(item => {
const isFav = isFavorite(localidadName, category, item.name);
const note = getNote(localidadName, category, item.name);

// Usar comillas dobles para onclick y escapar comillas dobles internas
html += `<div class="item">
<div style="display:flex;justify-content:space-between;align-items:start;gap:10px">
<div class="item-title">${emoji} ${item.name}</div>
<button class="btn-favorite ${isFav ? 'favorited' : ''}" 
onclick='toggleFavorite("${localidadName}","${category}","${item.name.replace(/"/g, '&quot;')}");'>
${isFav ? '‚≠ê' : '‚òÜ'}
</button>
</div>

<img src="${item.image}" alt="${item.name}" class="item-image" onerror="this.style.display='none';">
<div class="item-desc">${item.desc}</div>`;

// √Årea de notas
html += `<div style="margin:15px 0;padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;border-left:4px solid #d4af37;">
<strong style="color:#d4af37;font-size:0.95rem;">üìù Mis notas:</strong>
<textarea class="note-input" 
placeholder="A√±ade tus notas aqu√≠..." 
onblur='saveNote("${localidadName}","${category}","${item.name.replace(/"/g, '&quot;')}",this.value);'
style="width:100%;min-height:60px;background:rgba(30,15,15,0.7);color:white;border:1px solid #5d4037;border-radius:6px;padding:8px;margin-top:8px;font-size:0.95rem;resize:vertical;">${note}</textarea>
</div>`;

// Contacto o link seg√∫n categor√≠a
if (category === 'jamar') {
html += `<div class="contact-info">
<div>üìç ${item.address}</div>
<div>üìû ${item.phone}</div>
<div>üåê <a href="${item.web}" target="_blank" class="item-link">${item.web.replace('https://','')}</a></div>
</div>
<div class="item-extra">${item.extra}</div>`;
}

if (category === 'culturilla' || category === 'paseito') {
html += `<div class="item-details">
<div class="item-detail"><strong>‚ÑπÔ∏è</strong><span>${item.extra}</span></div>
</div>
<a href="${item.link}" target="_blank" class="item-link">üìñ M√°s informaci√≥n</a>`;
}

html += '</div>';
});

html += '</div>';
infoContent.innerHTML = html;
infoContent.classList.add('active');

// Cerrar botones de acci√≥n si est√°n abiertos
if (actionButtonsDiv) {
document.body.removeChild(actionButtonsDiv);
actionButtonsDiv = null;
document.removeEventListener('click', closeActionButtonsOnClickOutside);
}

setTimeout(() => {
document.getElementById('info-panel').scrollIntoView({ behavior: 'smooth', block: 'start' });
}, 100);
};

// Inicializar mapa cuando la p√°gina cargue
window.addEventListener('load', initMap);
</script>
</body>
</html>
